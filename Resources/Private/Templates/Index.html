<html
    xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
    xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
    data-namespace-typo3-fluid="true">

    <f:layout name="Backend/Default"/>

    <f:be.pageRenderer
            includeJavaScriptModules="{
         0: '@petitglacon/category-treebuilder/index.js'
      }"
    />

    <f:section name="Content">

        <ul id="customMenu">
            <li id="menuOption1">Menu Option 1</li>
            <li id="menuOption2">Menu Option 2</li>
            <li id="menuOption3">Menu Option 3</li>
        </ul>

        <input id="hiddenTreeJson" type="text" value="{jsonTree}" class="hidden">
        <input id="info" type="text" value="{info}" class="hidden">

        <div class="container-fluid">
            <div class="d-flex">

                <div class="col-3">

                    <div class="row">
                        <div class="col-6">
                            <h1>Category Tree Builder</h1>
                            <p>Links</p>
                            <ul class="list-group">
                                <li><a class="list-group-item" href="https://github.com/lepetitglacon/category_treebuilder" target="_blank">See on Github</a></li>
                                <li><a class="list-group-item" href="https://petitglacon.com" target="_blank">petitglacon.com</a></li>
                            </ul>
                        </div>
                        <div class="col-6">
                        </div>
                    </div>
                </div>

                <div class="col-6">
                    <div class="row d-flex">

                        <f:comment><!-- Tree builder --></f:comment>
                        <div class="col">
                            <div class="row">
                                <h2>Category Tree Builder</h2>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <f:form action="build" controller="Tree" enctype="application/x-www-form-urlencoded">
                                        <div class="mb-3">
                                            <textarea class="form-control" id="textarea" name="textCategoryTree" rows="25" placeholder="Root&#10;&#09;Child 1&#10;&#09;&#09;Grand children&#10;&#09;Child 2"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="root-pid" class="form-label">Categories pid</label>
                                            <input type="number" class="form-control" id="root-pid" name="root-pid">
                                        </div>
                                        <f:form.submit name="submit" value="Envoyer" class="submit form-control btn btn-success" id="text-submit"/>
                                    </f:form>
                                </div>
                            </div>
                        </div>

                        <f:comment><!-- Tree viewer --></f:comment>
                        <div class="col">
                            <div class="row">
                                <h2>Category Tree Viewer</h2>
                            </div>
                            <div id="treeViewerScroll" class="row">
                                <div class="col">
                                    <div class="container">
                                        <ul id="myUL" class="ml-2">
                                            <f:for each="{tree}" as="treeRoot">
                                                <f:render section="list" arguments="{category:treeRoot}"/>
                                            </f:for>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-3">

                    <h2>Import/Export</h2>

                    <div class="row my-2">
                        <h4>CSV</h4>

                        <div class="col">
                            <f:form action="import" controller="Tree" enctype="multipart/form-data">
                                <input class="form-control" type="file" id="formFile" name="file">
                                <f:form.submit name="import" value="Import" class="submit form-control btn btn-default"/>
                            </f:form>
                        </div>

                        <div class="col">
                            <a href="{f:uri.action(action:'export')}" class="btn btn-default">Export to CSV</a>
                        </div>

                    </div>

                    <div class="row my-2">
                        <h4>JSON</h4>

                        <div class="col">
                            <f:form action="import" controller="Tree" enctype="multipart/form-data">
                                <input class="form-control" type="file" id="formFile" name="file" >
                                <f:form.submit name="import" value="Import" class="submit form-control btn btn-default"/>
                            </f:form>
                        </div>

                        <div class="col">
                            <a href="{f:uri.action(action:'export')}" class="btn btn-default" >Export to JSON</a>
                        </div>

                    </div>


                </div>
            </div>





        </div>
    </f:section>

    <f:section name="list">
        <li><span class="cat-caret"><span class="cat-icon"><core:icon identifier="mimetypes-x-sys_category"/></span> {category.title}</span>
            <ul class="cat-nested">

                <f:if condition="{category.children -> f:count()}">
                    <f:for each="{category.children}" as="cat">
                        <f:if condition="{cat.children -> f:count()}">
                            <f:then>
                                <f:render section="list" arguments="{category:cat}"></f:render>
                            </f:then>
                            <f:else>
                                <li><span class="cat-icon"><core:icon identifier="mimetypes-x-sys_category"/></span> {cat.title}</li>
                            </f:else>
                        </f:if>
                    </f:for>
                </f:if>

            </ul>
        </li>
    </f:section>

</html>